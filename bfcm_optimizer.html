<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur BFCM - Unit Economics & Scénarios</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: #f1f5f9;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 1px solid #e2e8f0;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover:not(.active) {
            background: #e2e8f0;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .economics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .card h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #374151;
        }

        .result-value {
            font-weight: 700;
            color: #059669;
            font-size: 1.1em;
        }

        .result-value.negative {
            color: #dc2626;
        }

        .scenario-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .scenario-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .scenario-result {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .big-number {
            font-size: 3em;
            font-weight: 800;
            margin: 10px 0;
        }

        .big-number.profit {
            color: #059669;
        }

        .big-number.loss {
            color: #dc2626;
        }

        .scenarios-table {
            margin-top: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        .profit-positive {
            color: #059669;
            font-weight: 600;
        }

        .profit-negative {
            color: #dc2626;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            .economics-grid {
                grid-template-columns: 1fr;
            }
            
            .scenario-inputs {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Simulateur BFCM 2024</h1>
            <p>Unit Economics & Scénarios Marketing en Français</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('economics')">
                📊 Unit Economics
            </button>
            <button class="tab" onclick="switchTab('scenarios')">
                💰 Simulateur de Profits
            </button>
        </div>

        <!-- TAB 1: Unit Economics -->
        <div id="economics" class="tab-content active">
            <div class="economics-grid">
                <!-- Revenus -->
                <div class="card">
                    <h3>💰 Revenus par Commande</h3>
                    <div class="input-group">
                        <label>Panier Moyen BFCM (€)</label>
                        <input type="number" id="aov" value="60" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>TVA/Taxes par commande (€)</label>
                        <input type="number" id="vat" value="10" onchange="calculateEconomics()">
                    </div>
                    <div class="result-item">
                        <span class="result-label">Revenus nets par commande</span>
                        <span class="result-value" id="netRevenue">50,00 €</span>
                    </div>
                </div>

                <!-- Coûts Variables -->
                <div class="card">
                    <h3>📦 Coûts Variables par Commande</h3>
                    <div class="input-group">
                        <label>Coût produit (COGS) (€)</label>
                        <input type="number" id="cogs" value="12" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Frais de livraison (€)</label>
                        <input type="number" id="shipping" value="1" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Frais de transaction (€)</label>
                        <input type="number" id="transaction" value="1.8" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Pick & Pack (€)</label>
                        <input type="number" id="pickpack" value="2" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Emballage (€)</label>
                        <input type="number" id="packaging" value="0.28" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Fulfillment (€)</label>
                        <input type="number" id="fulfillment" value="1.2" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Taux de retour (€)</label>
                        <input type="number" id="returns" value="0.42" onchange="calculateEconomics()">
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total COD</span>
                        <span class="result-value negative" id="totalCosts">18,70 €</span>
                    </div>
                </div>

                <!-- Coûts Fixes -->
                <div class="card">
                    <h3>🏢 Coûts Fixes Mensuels</h3>
                    <div class="input-group">
                        <label>Frais d'agence (€/mois)</label>
                        <input type="number" id="agency" value="12175" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Salaires (€/mois)</label>
                        <input type="number" id="payroll" value="12500" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Loyer/Bureau (€/mois)</label>
                        <input type="number" id="rent" value="2500" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Logiciels (€/mois)</label>
                        <input type="number" id="software" value="1800" onchange="calculateEconomics()">
                    </div>
                    <div class="input-group">
                        <label>Autres frais G&A (€/mois)</label>
                        <input type="number" id="admin" value="2000" onchange="calculateEconomics()">
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total coûts fixes/mois</span>
                        <span class="result-value negative" id="totalFixed">30 975 €</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Coûts fixes/jour</span>
                        <span class="result-value negative" id="dailyFixed">1 032 €</span>
                    </div>
                </div>

                <!-- Résultats -->
                <div class="card">
                    <h3>📈 Résultats & Targets</h3>
                    <div class="result-item">
                        <span class="result-label">Marge brute par commande</span>
                        <span class="result-value" id="grossProfit">31,30 €</span>
                    </div>
                    <div class="input-group">
                        <label>Objectif marge contribution (€)</label>
                        <input type="number" id="contributionProfit" value="3" onchange="calculateEconomics()">
                    </div>
                    <div class="result-item">
                        <span class="result-label">ROAS de rentabilité</span>
                        <span class="result-value" id="breakevènROAS">1,92</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ROAS objectif</span>
                        <span class="result-value" id="targetROAS">2,12</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">CPA maximum</span>
                        <span class="result-value" id="maxCPA">28,30 €</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn" onclick="exportEconomics()">
                    📥 Exporter Unit Economics (Excel)
                </button>
            </div>
        </div>

        <!-- TAB 2: Simulateur de Scénarios -->
        <div id="scenarios" class="tab-content">
            <div class="scenario-section">
                <h2>💰 Simulateur : "Si je dépense X€ → J'obtiens Y€ de profit"</h2>
                
                <div class="scenario-inputs">
                    <div class="input-group">
                        <label>Budget Marketing (€)</label>
                        <input type="number" id="marketingBudget" value="5000" onchange="calculateScenario()">
                    </div>
                    <div class="input-group">
                        <label>ROAS attendu</label>
                        <input type="number" id="expectedROAS" value="3.5" step="0.1" onchange="calculateScenario()">
                    </div>
                    <div class="input-group">
                        <label>Durée campagne (jours)</label>
                        <input type="number" id="campaignDays" value="30" onchange="calculateScenario()">
                    </div>
                </div>

                <div class="scenario-result">
                    <h3>Résultat du scénario</h3>
                    <div>Revenus générés: <span id="generatedRevenue" class="big-number profit">17 500 €</span></div>
                    <div>Profit net: <span id="netProfit" class="big-number profit">8 325 €</span></div>
                    <div>ROI: <span id="roi" class="big-number profit">166%</span></div>
                </div>
            </div>

            <div class="scenarios-table">
                <h3>📊 Table de Scénarios Automatiques</h3>
                <table id="scenariosTable">
                    <thead>
                        <tr>
                            <th>Budget Marketing</th>
                            <th>ROAS</th>
                            <th>Revenus Générés</th>
                            <th>Coûts Variables</th>
                            <th>Coûts Fixes (30j)</th>
                            <th>Profit Net</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody id="scenariosBody">
                    </tbody>
                </table>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="exportScenarios()">
                    📥 Exporter Scénarios (Excel)
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentData = {
            aov: 60,
            vat: 10,
            cogs: 12,
            shipping: 1,
            transaction: 1.8,
            pickpack: 2,
            packaging: 0.28,
            fulfillment: 1.2,
            returns: 0.42,
            agency: 12175,
            payroll: 12500,
            rent: 2500,
            software: 1800,
            admin: 2000,
            contributionProfit: 3
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'scenarios') {
                generateScenariosTable();
            }
        }

        function calculateEconomics() {
            // Récupérer les valeurs des inputs
            currentData.aov = parseFloat(document.getElementById('aov').value) || 0;
            currentData.vat = parseFloat(document.getElementById('vat').value) || 0;
            currentData.cogs = parseFloat(document.getElementById('cogs').value) || 0;
            currentData.shipping = parseFloat(document.getElementById('shipping').value) || 0;
            currentData.transaction = parseFloat(document.getElementById('transaction').value) || 0;
            currentData.pickpack = parseFloat(document.getElementById('pickpack').value) || 0;
            currentData.packaging = parseFloat(document.getElementById('packaging').value) || 0;
            currentData.fulfillment = parseFloat(document.getElementById('fulfillment').value) || 0;
            currentData.returns = parseFloat(document.getElementById('returns').value) || 0;
            currentData.agency = parseFloat(document.getElementById('agency').value) || 0;
            currentData.payroll = parseFloat(document.getElementById('payroll').value) || 0;
            currentData.rent = parseFloat(document.getElementById('rent').value) || 0;
            currentData.software = parseFloat(document.getElementById('software').value) || 0;
            currentData.admin = parseFloat(document.getElementById('admin').value) || 0;
            currentData.contributionProfit = parseFloat(document.getElementById('contributionProfit').value) || 0;

            // Calculs
            const netRevenue = currentData.aov - currentData.vat;
            const totalVariableCosts = currentData.cogs + currentData.shipping + currentData.transaction + 
                                     currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns;
            const grossProfit = netRevenue - totalVariableCosts;
            const totalFixedMonthly = currentData.agency + currentData.payroll + currentData.rent + currentData.software + currentData.admin;
            const dailyFixed = totalFixedMonthly / 30;
            
            const maxAdSpend = grossProfit - currentData.contributionProfit;
            const breakevènROAS = netRevenue / maxAdSpend;
            const targetROAS = breakevènROAS;

            // Mise à jour de l'affichage
            document.getElementById('netRevenue').textContent = netRevenue.toFixed(2) + ' €';
            document.getElementById('totalCosts').textContent = totalVariableCosts.toFixed(2) + ' €';
            document.getElementById('totalFixed').textContent = totalFixedMonthly.toLocaleString() + ' €';
            document.getElementById('dailyFixed').textContent = dailyFixed.toFixed(0) + ' €';
            document.getElementById('grossProfit').textContent = grossProfit.toFixed(2) + ' €';
            document.getElementById('breakevènROAS').textContent = breakevènROAS.toFixed(2);
            document.getElementById('targetROAS').textContent = targetROAS.toFixed(2);
            document.getElementById('maxCPA').textContent = maxAdSpend.toFixed(2) + ' €';

            // Mettre à jour le simulateur
            calculateScenario();
        }

        function calculateScenario() {
            const marketingBudget = parseFloat(document.getElementById('marketingBudget').value) || 0;
            const expectedROAS = parseFloat(document.getElementById('expectedROAS').value) || 0;
            const campaignDays = parseFloat(document.getElementById('campaignDays').value) || 30;

            const generatedRevenue = marketingBudget * expectedROAS;
            const netRevenue = currentData.aov - currentData.vat;
            const totalVariableCosts = currentData.cogs + currentData.shipping + currentData.transaction + 
                                     currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns;
            const grossProfitPerOrder = netRevenue - totalVariableCosts;
            
            const orders = generatedRevenue / currentData.aov;
            const totalGrossProfit = orders * grossProfitPerOrder;
            const totalFixedMonthly = currentData.agency + currentData.payroll + currentData.rent + currentData.software + currentData.admin;
            const fixedCostsForPeriod = (totalFixedMonthly / 30) * campaignDays;
            
            const netProfit = totalGrossProfit - marketingBudget - fixedCostsForPeriod;
            const roi = ((netProfit / marketingBudget) * 100);

            document.getElementById('generatedRevenue').textContent = generatedRevenue.toLocaleString() + ' €';
            document.getElementById('netProfit').textContent = netProfit.toLocaleString() + ' €';
            document.getElementById('roi').textContent = roi.toFixed(0) + '%';

            // Mettre à jour les classes pour profit/perte
            const profitElement = document.getElementById('netProfit');
            const roiElement = document.getElementById('roi');
            
            if (netProfit >= 0) {
                profitElement.className = 'big-number profit';
                roiElement.className = 'big-number profit';
            } else {
                profitElement.className = 'big-number loss';
                roiElement.className = 'big-number loss';
            }
        }

        function generateScenariosTable() {
            const tbody = document.getElementById('scenariosBody');
            tbody.innerHTML = '';
            
            const budgets = [1000, 2500, 5000, 7500, 10000, 15000, 20000, 30000];
            const roasValues = [2.0, 2.5, 3.0, 3.5, 4.0];
            
            const netRevenue = currentData.aov - currentData.vat;
            const totalVariableCosts = currentData.cogs + currentData.shipping + currentData.transaction + 
                                     currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns;
            const grossProfitPerOrder = netRevenue - totalVariableCosts;
            const totalFixedMonthly = currentData.agency + currentData.payroll + currentData.rent + currentData.software + currentData.admin;

            budgets.forEach(budget => {
                roasValues.forEach(roas => {
                    const generatedRevenue = budget * roas;
                    const orders = generatedRevenue / currentData.aov;
                    const totalGrossProfit = orders * grossProfitPerOrder;
                    const variableCosts = orders * totalVariableCosts;
                    const netProfit = totalGrossProfit - budget - totalFixedMonthly;
                    const roi = ((netProfit / budget) * 100);

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${budget.toLocaleString()} €</td>
                        <td>${roas.toFixed(1)}</td>
                        <td>${generatedRevenue.toLocaleString()} €</td>
                        <td>${variableCosts.toLocaleString()} €</td>
                        <td>${totalFixedMonthly.toLocaleString()} €</td>
                        <td class="${netProfit >= 0 ? 'profit-positive' : 'profit-negative'}">${netProfit.toLocaleString()} €</td>
                        <td class="${roi >= 0 ? 'profit-positive' : 'profit-negative'}">${roi.toFixed(0)}%</td>
                    `;
                });
            });
        }

        function exportEconomics() {
            const wb = XLSX.utils.book_new();
            
            const economicsData = [
                ['UNIT ECONOMICS BFCM 2024 - FRANÇAIS', '', '', ''],
                ['', '', '', ''],
                ['REVENUS PAR COMMANDE', '', '', ''],
                ['Panier Moyen BFCM (€)', currentData.aov, '', ''],
                ['TVA/Taxes par commande (€)', currentData.vat, '', ''],
                ['Revenus nets par commande (€)', currentData.aov - currentData.vat, '', ''],
                ['', '', '', ''],
                ['COÛTS VARIABLES PAR COMMANDE', '', '', ''],
                ['Coût produit (COGS) (€)', currentData.cogs, '', ''],
                ['Frais de livraison (€)', currentData.shipping, '', ''],
                ['Frais de transaction (€)', currentData.transaction, '', ''],
                ['Pick & Pack (€)', currentData.pickpack, '', ''],
                ['Emballage (€)', currentData.packaging, '', ''],
                ['Fulfillment (€)', currentData.fulfillment, '', ''],
                ['Taux de retour (€)', currentData.returns, '', ''],
                ['Total COD (€)', currentData.cogs + currentData.shipping + currentData.transaction + currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns, '', ''],
                ['', '', '', ''],
                ['COÛTS FIXES MENSUELS', '', '', ''],
                ['Frais d\'agence (€/mois)', currentData.agency, '', ''],
                ['Salaires (€/mois)', currentData.payroll, '', ''],
                ['Loyer/Bureau (€/mois)', currentData.rent, '', ''],
                ['Logiciels (€/mois)', currentData.software, '', ''],
                ['Autres frais G&A (€/mois)', currentData.admin, '', ''],
                ['Total coûts fixes/mois (€)', currentData.agency + currentData.payroll + currentData.rent + currentData.software + currentData.admin, '', ''],
                ['', '', '', ''],
                ['RÉSULTATS & TARGETS', '', '', ''],
                ['Marge brute par commande (€)', (currentData.aov - currentData.vat) - (currentData.cogs + currentData.shipping + currentData.transaction + currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns), '', ''],
                ['Objectif marge contribution (€)', currentData.contributionProfit, '', '']
            ];

            const ws1 = XLSX.utils.aoa_to_sheet(economicsData);
            XLSX.utils.book_append_sheet(wb, ws1, "Unit Economics FR");

            XLSX.writeFile(wb, 'BFCM_Unit_Economics_FR.xlsx');
        }

        function exportScenarios() {
            const wb = XLSX.utils.book_new();
            
            const scenariosData = [
                ['SIMULATEUR DE SCÉNARIOS BFCM 2024', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Budget Marketing (€)', 'ROAS', 'Revenus Générés (€)', 'Coûts Variables (€)', 'Coûts Fixes 30j (€)', 'Profit Net (€)', 'ROI (%)']
            ];

            const budgets = [1000, 2500, 5000, 7500, 10000, 15000, 20000, 30000];
            const roasValues = [2.0, 2.5, 3.0, 3.5, 4.0];
            
            const netRevenue = currentData.aov - currentData.vat;
            const totalVariableCosts = currentData.cogs + currentData.shipping + currentData.transaction + 
                                     currentData.pickpack + currentData.packaging + currentData.fulfillment + currentData.returns;
            const grossProfitPerOrder = netRevenue - totalVariableCosts;
            const totalFixedMonthly = currentData.agency + currentData.payroll + currentData.rent + currentData.software + currentData.admin;

            budgets.forEach(budget => {
                roasValues.forEach(roas => {
                    const generatedRevenue = budget * roas;
                    const orders = generatedRevenue / currentData.aov;
                    const totalGrossProfit = orders * grossProfitPerOrder;
                    const variableCosts = orders * totalVariableCosts;
                    const netProfit = totalGrossProfit - budget - totalFixedMonthly;
                